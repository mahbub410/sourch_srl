
SELECT * FROM EPAY_UTILITY_BILL
WHERE ACCOUNT_NUMBER='79026397'
and bill_month='201706'


select * from BC_BILL_IMAGE@BILLING_MYMEN
WHERE CUSTOMER_NUM='7902639'
AND BILL_CYCLE_CODE='201706'


SELECT * FROM EPAY_UTILITY_BILL
WHERE BILL_NUMBER=:P_Bill_Number
AND LOCATION_CODE =UPPER(:P_Loc_Code);

select * from BC_BILL_IMAGE@BILLING_jam
WHERE INVOICE_NUM=(SUBSTR(:P_BILL_NUMBER,1,LENGTH(:P_BILL_NUMBER)-1))
--AND BILL_CYCLE_CODE=:P_BILL_MONTH
AND INVOICE_NUM IS NOT NULL


INSERT INTO EPAY_UTILITY_BILL
SELECT 'BPDB' AS COMPANY_CODE, 
CUSTOMER_NUM||CONS_CHK_DIGIT AS ACCOUNT_NUMBER, 
INVOICE_NUM||INVOICE_CHK_DGT BILL_NUMBER, 
INVOICE_DATE GENERATED_DATE, 
'N' BILL_STATUS, 
INVOICE_DUE_DATE BILL_DUE_DATE, 
NULL BILLAMT_AFTERDUEDATE, 
INVOICE_DUE_DATE BILLENDDATE_FORPAYMENT, 
SYSDATE CREATED_ON    , 
USER CREATED_BY   , 
NULL  MODIFIED_ON , 
NULL MODIFIED_BY, 
'N' NOTIFICATION_SENT_STATUS, 
    (NVL(ENG_CHRG_SR,0)+ NVL(ENG_CHRG_OFPK,0)+NVL(ENG_CHRG_PK,0)+NVL(MINIMUM_CHRG,0) +NVL(SERVICE_CHRG,0)+ 
    NVL(DEMAND_CHRG,0)+NVL(XF_RENT,0)+NVL(XF_LOSS_CHRG,0)+NVL(PFC_CHARGE,0)+NVL(ENG_CHRG_MR1,0)+NVL(ENG_CHRG_MR2,0)+
    NVL(ENG_CHRG_MR3,0)+NVL(ENG_CHRG_MR4,0)) CURRENT_PRINCIPLE, 
NVL(CURRENT_VAT,0) CURRENT_GOVT_DUTY, 
NVL(ARR_ADV_ADJ_PRN,0)  ARREAR_PRINCIPLE, 
NVL(ARR_ADV_ADJ_VAT,0) ARREAR_GOVT_DUTY, 
0 LATE_PAYMENT_SURCHARGE, 
NVL(TOTAL_BILL,0) TOTAL_BILL_AMOUNT, 
LOCATION_CODE, 
BILL_CYCLE_CODE BILL_MONTH, 
TARIFF, CUST_STATUS CUSTOMER_TYPE, 
NVL(CURRENT_LPS,0) CURRENT_SURCHARGE, 
NVL(ARR_ADV_ADJ_LPS,0) ARREAR_SURCHARGE, 
NVL(ADJUSTED_PRN,0)+NVL(ADJUSTED_LPS,0) ADJUSTED_PRINCIPLE, 
NVL(ADJUSTED_VAT,0) ADJUSTED_GOVT_DUTY, 
0  ADVANCE_AMOUNT,0 ADJ_ADV_GOVT_DUTY,'T' DATA_TRANS_LOG, 'T' DATA_TRANS_LOG1, 'T' DATA_TRANS_LOG2, 'T' DATA_TRANS_LOG3, 'T' DATA_TRANS_LOG4, 'T' DATA_TRANS_LOG5
               FROM  BC_BILL_IMAGE@BILLING_ctg
WHERE INVOICE_NUM=(SUBSTR(:P_BILL_NUMBER,1,LENGTH(:P_BILL_NUMBER)-1))
--AND BILL_CYCLE_CODE=:P_BILL_MONTH
AND INVOICE_NUM IS NOT NULL


                          
COMMIT;



INSERT INTO EPAY_UTILITY_BILL
select * from EPAYMENT.EPAY_UTILITY_BILL_HSTR
WHERE BILL_NUMBER=:P_BILL_NUMBER
AND LOCATION_CODE='E2'

COMMIT;


UPDATE EPAY_UTILITY_BILL
SET BILL_DUE_DATE=TRUNC(SYSDATE),BILLENDDATE_FORPAYMENT=TRUNC(SYSDATE)
WHERE BILL_MONTH='201701'
AND bill_NUMBER='2153359640'


COMMIT;


